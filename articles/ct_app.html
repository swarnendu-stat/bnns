<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Bayesian Neural Networks in Clinical Trials â€¢ bnns</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Bayesian Neural Networks in Clinical Trials">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bnns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bnns.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ct_app.html">Using Bayesian Neural Networks in Clinical Trials</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/swarnendu-stat/bnns/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using Bayesian Neural Networks in Clinical Trials</h1>
                        <h4 data-toc-skip class="author">Swarnendu
Chatterjee</h4>
            
            <h4 data-toc-skip class="date">2025-01-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/swarnendu-stat/bnns/blob/master/vignettes/ct_app.Rmd" class="external-link"><code>vignettes/ct_app.Rmd</code></a></small>
      <div class="d-none name"><code>ct_app.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Bayesian Neural Networks (BNNs) offer a robust framework for
prediction in clinical trials by providing posterior distributions of
predictions. This allows for probabilistic reasoning, such as computing
the probability that a treatment achieves a certain efficacy threshold
or proportion of success.</p>
<p>In this vignette, we: 1. Illustrate data preparation for a clinical
trial setting. 2. Fit a BNN to simulate clinical trial outcomes. 3.
Leverage posterior distributions for decision-making, such as
calculating posterior probabilities of treatment success.</p>
<hr>
</div>
<div class="section level2">
<h2 id="data-preparation">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Consider a hypothetical clinical trial comparing the efficacy of a
new treatment against a placebo. The response variable is binary,
representing treatment success (1) or failure (0).</p>
<div class="section level3">
<h3 id="simulating-data">Simulating Data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate predictor variables (e.g., patient covariates)</span></span>
<span><span class="va">n_subjects</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">Age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_subjects</span>, <span class="fl">18</span>, <span class="fl">50</span><span class="op">)</span> <span class="co"># Age in years</span></span>
<span><span class="va">Dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_subjects</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># Dose levels</span></span>
<span><span class="va">Severity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_subjects</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Baseline severity (arbitrary scale)</span></span>
<span></span>
<span><span class="co"># Define true probabilities using a nonlinear function</span></span>
<span><span class="va">beta_0</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.1</span></span>
<span><span class="va">beta_3</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.02</span></span>
<span><span class="va">beta_4</span> <span class="op">&lt;-</span> <span class="fl">0.005</span></span>
<span></span>
<span><span class="va">logit_p</span> <span class="op">&lt;-</span> <span class="va">beta_0</span> <span class="op">+</span> <span class="va">beta_1</span> <span class="op">*</span> <span class="va">Dose</span> <span class="op">+</span> <span class="va">beta_2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Severity</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">beta_3</span> <span class="op">*</span> <span class="va">Age</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">beta_4</span> <span class="op">*</span> <span class="op">(</span><span class="va">Age</span> <span class="op">*</span> <span class="va">Dose</span><span class="op">)</span></span>
<span><span class="va">p_success</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">logit_p</span><span class="op">)</span><span class="op">)</span> <span class="co"># Sigmoid transformation</span></span>
<span></span>
<span><span class="co"># Simulate binary outcomes</span></span>
<span><span class="va">Success</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_subjects</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p_success</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trial_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">Success</span>, <span class="va">Age</span>, <span class="va">Dose</span>, <span class="va">Severity</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split into training and testing</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_subjects</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">n_subjects</span><span class="op">)</span></span>
<span><span class="va">training_data</span> <span class="op">&lt;-</span> <span class="va">trial_data</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">trial_data</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="fitting-a-bayesian-neural-network">2. Fitting a Bayesian Neural Network<a class="anchor" aria-label="anchor" href="#fitting-a-bayesian-neural-network"></a>
</h2>
<p>Fit a BNN to the simulated data. We use a binary classification model
with a logistic sigmoid activation for the output layer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a BNN</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnns.html">bnns</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Success</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">training_data</span>,</span>
<span>  L <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Number of hidden layers</span></span>
<span>  nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">8</span><span class="op">)</span>, <span class="co"># Nodes per layer</span></span>
<span>  act_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># Activation functions for hidden layers</span></span>
<span>  out_act_fn <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Output activation: logistic sigmoid</span></span>
<span>  iter <span class="op">=</span> <span class="fl">2e2</span>, <span class="co"># Bayesian sampling iterations</span></span>
<span>  warmup <span class="op">=</span> <span class="fl">1e2</span>, <span class="co"># Warmup iterations</span></span>
<span>  chains <span class="op">=</span> <span class="fl">1</span> <span class="co"># Number of MCMC chains</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="posterior-predictions">3. Posterior Predictions<a class="anchor" aria-label="anchor" href="#posterior-predictions"></a>
</h2>
<div class="section level3">
<h3 id="generating-predictions-with-uncertainty">Generating Predictions with Uncertainty<a class="anchor" aria-label="anchor" href="#generating-predictions-with-uncertainty"></a>
</h3>
<p>The posterior distribution of predictions allows us to compute not
just point estimates but also probabilistic metrics.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate posterior predictions for the test set</span></span>
<span><span class="va">posterior_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">test_data</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Success</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">posterior_preds</span><span class="op">)</span> <span class="co"># Each row corresponds to a subject, and columns are MCMC samples</span></span>
<span><span class="co">#&gt;            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]</span></span>
<span><span class="co">#&gt; [1,] 0.95360552 0.95021834 0.94580631 0.97381018 0.94068344 0.96359538</span></span>
<span><span class="co">#&gt; [2,] 0.06315939 0.09741205 0.09364063 0.07900010 0.40425935 0.10932841</span></span>
<span><span class="co">#&gt; [3,] 0.14972664 0.11282616 0.07849459 0.04564657 0.10429327 0.07485027</span></span>
<span><span class="co">#&gt; [4,] 0.94598885 0.95010117 0.94321209 0.97329536 0.94057337 0.96320307</span></span>
<span><span class="co">#&gt; [5,] 0.77604624 0.92940934 0.37841744 0.59757302 0.80367070 0.42113683</span></span>
<span><span class="co">#&gt; [6,] 0.05192679 0.09933909 0.05331637 0.03240259 0.07729776 0.07236551</span></span>
<span><span class="co">#&gt;            [,7]       [,8]       [,9]      [,10]     [,11]      [,12]</span></span>
<span><span class="co">#&gt; [1,] 0.96033781 0.95126412 0.95958453 0.98799108 0.9221397 0.88252517</span></span>
<span><span class="co">#&gt; [2,] 0.09085240 0.07730268 0.15265533 0.12565185 0.1029894 0.05112108</span></span>
<span><span class="co">#&gt; [3,] 0.11647928 0.07896275 0.15455183 0.05483277 0.1090577 0.06512479</span></span>
<span><span class="co">#&gt; [4,] 0.95256125 0.95126325 0.95917550 0.99033757 0.9223156 0.90678143</span></span>
<span><span class="co">#&gt; [5,] 0.44855007 0.73394715 0.72664563 0.60914730 0.6083129 0.75588868</span></span>
<span><span class="co">#&gt; [6,] 0.04244795 0.10405776 0.07834502 0.04424655 0.1151133 0.06173186</span></span>
<span><span class="co">#&gt;           [,13]      [,14]     [,15]      [,16]     [,17]      [,18]     [,19]</span></span>
<span><span class="co">#&gt; [1,] 0.94826062 0.98336299 0.9483871 0.93820027 0.9389601 0.91249512 0.9250233</span></span>
<span><span class="co">#&gt; [2,] 0.06410978 0.08864533 0.1461942 0.05711957 0.1273991 0.09691140 0.1825022</span></span>
<span><span class="co">#&gt; [3,] 0.09552574 0.10258413 0.1546943 0.05010718 0.1128786 0.05646500 0.1824316</span></span>
<span><span class="co">#&gt; [4,] 0.92006090 0.95337677 0.9473623 0.92913291 0.9388833 0.91013212 0.8475761</span></span>
<span><span class="co">#&gt; [5,] 0.27954728 0.42333314 0.5446129 0.09064981 0.8259752 0.67166452 0.7611848</span></span>
<span><span class="co">#&gt; [6,] 0.11198219 0.10121687 0.1339196 0.04884905 0.1020319 0.07528487 0.1799139</span></span>
<span><span class="co">#&gt;          [,20]      [,21]      [,22]      [,23]     [,24]      [,25]     [,26]</span></span>
<span><span class="co">#&gt; [1,] 0.8570123 0.95188447 0.93614653 0.97915223 0.9538411 0.88670961 0.8164815</span></span>
<span><span class="co">#&gt; [2,] 0.2108441 0.01876517 0.05159579 0.06854279 0.1419617 0.07576468 0.2072758</span></span>
<span><span class="co">#&gt; [3,] 0.2106688 0.02228304 0.09136696 0.07607244 0.1582908 0.07623292 0.2078918</span></span>
<span><span class="co">#&gt; [4,] 0.8570123 0.95186947 0.88334698 0.96920041 0.9211345 0.91911254 0.8163489</span></span>
<span><span class="co">#&gt; [5,] 0.2227564 0.33119388 0.82013013 0.91679389 0.8649880 0.55718589 0.4057789</span></span>
<span><span class="co">#&gt; [6,] 0.2259007 0.02640083 0.06031167 0.06703606 0.2051299 0.10078710 0.2690523</span></span>
<span><span class="co">#&gt;           [,27]      [,28]      [,29]      [,30]      [,31]      [,32]</span></span>
<span><span class="co">#&gt; [1,] 0.93448124 0.83093886 0.95971761 0.93211563 0.88580751 0.76933197</span></span>
<span><span class="co">#&gt; [2,] 0.05282613 0.09073357 0.06147170 0.39366445 0.18901170 0.02742836</span></span>
<span><span class="co">#&gt; [3,] 0.02751751 0.09145168 0.07648255 0.17540935 0.07081170 0.03542751</span></span>
<span><span class="co">#&gt; [4,] 0.89772796 0.83087890 0.95971782 0.91909721 0.88379427 0.76907414</span></span>
<span><span class="co">#&gt; [5,] 0.47736025 0.60638296 0.66572018 0.27103498 0.41133933 0.76177210</span></span>
<span><span class="co">#&gt; [6,] 0.02637232 0.09142162 0.06127533 0.06807762 0.07100077 0.02757636</span></span>
<span><span class="co">#&gt;          [,33]      [,34]      [,35]     [,36]      [,37]     [,38]     [,39]</span></span>
<span><span class="co">#&gt; [1,] 0.9691211 0.95037079 0.91495821 0.9293669 0.90981579 0.9728767 0.9576554</span></span>
<span><span class="co">#&gt; [2,] 0.1592738 0.02956163 0.07804768 0.1954525 0.18927290 0.1623113 0.1544121</span></span>
<span><span class="co">#&gt; [3,] 0.2768682 0.21686511 0.07813405 0.2394636 0.13124826 0.1634386 0.1565894</span></span>
<span><span class="co">#&gt; [4,] 0.9541437 0.91899709 0.83258184 0.9274860 0.88273197 0.9663756 0.8989994</span></span>
<span><span class="co">#&gt; [5,] 0.7496194 0.65550849 0.21909992 0.6373298 0.74355243 0.6767925 0.7790926</span></span>
<span><span class="co">#&gt; [6,] 0.2818228 0.10205964 0.11796825 0.1921952 0.08522386 0.1886304 0.1693040</span></span>
<span><span class="co">#&gt;          [,40]      [,41]      [,42]      [,43]     [,44]      [,45]      [,46]</span></span>
<span><span class="co">#&gt; [1,] 0.9101893 0.91970037 0.90658425 0.95117991 0.9822602 0.91742259 0.96650912</span></span>
<span><span class="co">#&gt; [2,] 0.1149193 0.09188143 0.03521565 0.14456716 0.1213527 0.04969016 0.06183125</span></span>
<span><span class="co">#&gt; [3,] 0.1129824 0.09100565 0.07006517 0.09862832 0.2124452 0.06168066 0.07803220</span></span>
<span><span class="co">#&gt; [4,] 0.8882882 0.91749136 0.90351073 0.95036190 0.9694353 0.91739252 0.96175475</span></span>
<span><span class="co">#&gt; [5,] 0.6578412 0.47061066 0.72008646 0.45478921 0.7476535 0.64267045 0.82180155</span></span>
<span><span class="co">#&gt; [6,] 0.1175729 0.07193414 0.03138329 0.11224624 0.1384847 0.04272127 0.07460268</span></span>
<span><span class="co">#&gt;           [,47]     [,48]      [,49]      [,50]      [,51]      [,52]     [,53]</span></span>
<span><span class="co">#&gt; [1,] 0.97492818 0.9527216 0.95113976 0.93690596 0.95197720 0.97297608 0.9059660</span></span>
<span><span class="co">#&gt; [2,] 0.12358277 0.1387682 0.08204913 0.06798811 0.04073058 0.11865216 0.1427125</span></span>
<span><span class="co">#&gt; [3,] 0.07277895 0.1493934 0.08187902 0.22042299 0.17493907 0.11776046 0.1116551</span></span>
<span><span class="co">#&gt; [4,] 0.97499294 0.9527074 0.85641502 0.93586722 0.94918490 0.97273670 0.7854650</span></span>
<span><span class="co">#&gt; [5,] 0.83792639 0.6710783 0.51332833 0.84793377 0.60336654 0.88924304 0.4423166</span></span>
<span><span class="co">#&gt; [6,] 0.03527414 0.1256664 0.05142583 0.07758123 0.12551438 0.02654554 0.1999366</span></span>
<span><span class="co">#&gt;          [,54]     [,55]     [,56]      [,57]     [,58]     [,59]      [,60]</span></span>
<span><span class="co">#&gt; [1,] 0.9190505 0.9547982 0.9011607 0.92761103 0.9340773 0.8931508 0.92166620</span></span>
<span><span class="co">#&gt; [2,] 0.1526169 0.1616560 0.1296130 0.06609694 0.1838781 0.1982891 0.16796344</span></span>
<span><span class="co">#&gt; [3,] 0.1781386 0.3765773 0.1120620 0.05661459 0.1868778 0.2053042 0.07366499</span></span>
<span><span class="co">#&gt; [4,] 0.9188180 0.9222772 0.8715837 0.92761047 0.9340964 0.8926439 0.91848922</span></span>
<span><span class="co">#&gt; [5,] 0.5072204 0.5919946 0.4245891 0.65641849 0.8038999 0.4518240 0.28096960</span></span>
<span><span class="co">#&gt; [6,] 0.1013064 0.3604606 0.1065209 0.12930304 0.2296690 0.2872912 0.11808435</span></span>
<span><span class="co">#&gt;           [,61]      [,62]     [,63]     [,64]      [,65]     [,66]     [,67]</span></span>
<span><span class="co">#&gt; [1,] 0.93396078 0.93471399 0.9652784 0.9330873 0.91512323 0.9450177 0.9292480</span></span>
<span><span class="co">#&gt; [2,] 0.05474521 0.03546805 0.1316126 0.1077329 0.05075558 0.2559873 0.1151109</span></span>
<span><span class="co">#&gt; [3,] 0.04890935 0.06782028 0.1776378 0.1145630 0.08794212 0.2212894 0.1315142</span></span>
<span><span class="co">#&gt; [4,] 0.93393227 0.93214157 0.9648835 0.9330872 0.91473128 0.9428492 0.9285513</span></span>
<span><span class="co">#&gt; [5,] 0.67508992 0.73598917 0.6865889 0.4235814 0.55106586 0.8371144 0.2889200</span></span>
<span><span class="co">#&gt; [6,] 0.05188726 0.18268001 0.3568487 0.0677504 0.06142090 0.1853769 0.1149471</span></span>
<span><span class="co">#&gt;           [,68]     [,69]      [,70]      [,71]      [,72]      [,73]</span></span>
<span><span class="co">#&gt; [1,] 0.98202096 0.8603917 0.93841203 0.91656721 0.94490384 0.93847974</span></span>
<span><span class="co">#&gt; [2,] 0.02021273 0.1003205 0.11673252 0.22982447 0.10470599 0.19191475</span></span>
<span><span class="co">#&gt; [3,] 0.01877231 0.1008062 0.08649589 0.05468524 0.08515729 0.11594363</span></span>
<span><span class="co">#&gt; [4,] 0.93430726 0.8584144 0.94627329 0.94324038 0.93478241 0.93843010</span></span>
<span><span class="co">#&gt; [5,] 0.41895573 0.3606970 0.89526535 0.49798637 0.73349326 0.70493744</span></span>
<span><span class="co">#&gt; [6,] 0.01559951 0.1006602 0.06878357 0.04211082 0.04942317 0.05747413</span></span>
<span><span class="co">#&gt;           [,74]      [,75]     [,76]      [,77]      [,78]      [,79]     [,80]</span></span>
<span><span class="co">#&gt; [1,] 0.88909075 0.98278828 0.8639886 0.96879020 0.96491291 0.90519402 0.8568571</span></span>
<span><span class="co">#&gt; [2,] 0.02375625 0.05936686 0.1532583 0.07583279 0.12075168 0.13622565 0.1425923</span></span>
<span><span class="co">#&gt; [3,] 0.09414987 0.06172718 0.1593923 0.06540429 0.09777358 0.13893618 0.2166740</span></span>
<span><span class="co">#&gt; [4,] 0.88012789 0.93171386 0.8940085 0.96884265 0.91455824 0.88949203 0.7810638</span></span>
<span><span class="co">#&gt; [5,] 0.55118557 0.29369107 0.5764709 0.73318432 0.37803663 0.54586348 0.2976378</span></span>
<span><span class="co">#&gt; [6,] 0.04178248 0.04856018 0.1502669 0.11169427 0.10363458 0.09729015 0.2196317</span></span>
<span><span class="co">#&gt;          [,81]     [,82]     [,83]      [,84]      [,85]     [,86]      [,87]</span></span>
<span><span class="co">#&gt; [1,] 0.9541870 0.8667449 0.9337858 0.97847860 0.97328000 0.9518035 0.96540544</span></span>
<span><span class="co">#&gt; [2,] 0.1528603 0.1620797 0.3168863 0.02675568 0.30049688 0.3168879 0.09688536</span></span>
<span><span class="co">#&gt; [3,] 0.0427016 0.1633061 0.1270849 0.01671995 0.17654239 0.1213549 0.09675958</span></span>
<span><span class="co">#&gt; [4,] 0.9541605 0.8611769 0.9337718 0.93622344 0.95527090 0.9252328 0.96193539</span></span>
<span><span class="co">#&gt; [5,] 0.6887550 0.7877992 0.5043067 0.84606755 0.47552655 0.5717879 0.68115868</span></span>
<span><span class="co">#&gt; [6,] 0.1028810 0.1614773 0.1353831 0.01130216 0.08714658 0.1211906 0.07057784</span></span>
<span><span class="co">#&gt;          [,88]      [,89]      [,90]      [,91]      [,92]      [,93]</span></span>
<span><span class="co">#&gt; [1,] 0.9547971 0.87635713 0.95538568 0.91332400 0.95599724 0.98577016</span></span>
<span><span class="co">#&gt; [2,] 0.1052705 0.07195412 0.04338679 0.07492102 0.06852273 0.14705369</span></span>
<span><span class="co">#&gt; [3,] 0.1055129 0.02586769 0.05436160 0.11121704 0.30145168 0.04992526</span></span>
<span><span class="co">#&gt; [4,] 0.9534533 0.87695772 0.91494129 0.89378463 0.85411298 0.98240236</span></span>
<span><span class="co">#&gt; [5,] 0.8558363 0.34412490 0.88552859 0.77241344 0.63225527 0.27430942</span></span>
<span><span class="co">#&gt; [6,] 0.1049393 0.01486669 0.02440260 0.05346084 0.40247117 0.04545387</span></span>
<span><span class="co">#&gt;           [,94]     [,95]      [,96]      [,97]      [,98]     [,99]    [,100]</span></span>
<span><span class="co">#&gt; [1,] 0.95044320 0.9603671 0.98383313 0.90337300 0.92044419 0.9730071 0.9461210</span></span>
<span><span class="co">#&gt; [2,] 0.06496306 0.2055474 0.05476457 0.05322308 0.10997617 0.1727534 0.1422422</span></span>
<span><span class="co">#&gt; [3,] 0.06181107 0.2059193 0.13782449 0.02806611 0.07243965 0.1057670 0.1419542</span></span>
<span><span class="co">#&gt; [4,] 0.95000504 0.9360937 0.95459042 0.88155150 0.91935129 0.9653030 0.9556160</span></span>
<span><span class="co">#&gt; [5,] 0.75774754 0.5155509 0.91215866 0.44654522 0.48406376 0.5783605 0.3642702</span></span>
<span><span class="co">#&gt; [6,] 0.05950760 0.1951705 0.05787978 0.01370030 0.05254762 0.1052707 0.1411693</span></span></code></pre></div>
<p>Each entry in <code>posterior_preds</code> represents the predicted
probability of success from a single posterior sample.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="posterior-probability-of-treatment-success">4. Posterior Probability of Treatment Success<a class="anchor" aria-label="anchor" href="#posterior-probability-of-treatment-success"></a>
</h2>
<div class="section level3">
<h3 id="threshold-based-decision-making">Threshold-Based Decision-Making<a class="anchor" aria-label="anchor" href="#threshold-based-decision-making"></a>
</h3>
<p>Suppose we define treatment success as a predicted probability â‰¥ 0.6.
We can compute the posterior probability that this threshold is met for
each subject.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute posterior probabilities of success (p_hat â‰¥ 0.6)</span></span>
<span><span class="va">success_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.6</span></span>
<span><span class="va">posterior_probs_success</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">posterior_preds</span> <span class="op">&gt;=</span> <span class="va">success_threshold</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">posterior_probs_success</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00 0.00 0.00 1.00 0.53 0.00</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="proportion-of-subjects-likely-to-achieve-success">Proportion of Subjects Likely to Achieve Success<a class="anchor" aria-label="anchor" href="#proportion-of-subjects-likely-to-achieve-success"></a>
</h3>
<p>Next, we calculate the posterior probability that a certain
proportion of subjects in the treatment group achieve success.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define success proportion threshold</span></span>
<span><span class="va">prop_success_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="co"># Simulate posterior proportion of success</span></span>
<span><span class="va">posterior_success_proportion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">posterior_preds</span> <span class="op">&gt;=</span> <span class="va">success_threshold</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior probability that â‰¥ 70% of subjects achieve success</span></span>
<span><span class="va">posterior_prob_high_success</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">posterior_success_proportion</span> <span class="op">&gt;=</span> <span class="va">prop_success_threshold</span><span class="op">)</span></span>
<span><span class="va">posterior_prob_high_success</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-posterior-insights">5. Visualizing Posterior Insights<a class="anchor" aria-label="anchor" href="#visualizing-posterior-insights"></a>
</h2>
<div class="section level3">
<h3 id="posterior-predictive-distribution">Posterior Predictive Distribution<a class="anchor" aria-label="anchor" href="#posterior-predictive-distribution"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot posterior probabilities of success for individual subjects</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span><span class="op">)</span>, Prob <span class="op">=</span> <span class="va">posterior_probs_success</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Subject</span>, y <span class="op">=</span> <span class="va">Prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">success_threshold</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Posterior Probability of Treatment Success"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Posterior Probability"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="ct_app_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="distribution-of-success-proportion">Distribution of Success Proportion<a class="anchor" aria-label="anchor" href="#distribution-of-success-proportion"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Histogram of posterior success proportions</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>SuccessProp <span class="op">=</span> <span class="va">posterior_success_proportion</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SuccessProp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"green"</span>, bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">prop_success_threshold</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Posterior Distribution of Success Proportion"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Proportion of Subjects Achieving Success"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="ct_app_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="clinical-trial-decision-making">6. Clinical Trial Decision-Making<a class="anchor" aria-label="anchor" href="#clinical-trial-decision-making"></a>
</h2>
<div class="section level3">
<h3 id="bayesian-probability-threshold">Bayesian Probability Threshold<a class="anchor" aria-label="anchor" href="#bayesian-probability-threshold"></a>
</h3>
<p>The posterior probability can guide decision-making. For example: -
If <code>posterior_prob_high_success &gt; 0.9</code>, consider the
treatment effective. - If
<code>posterior_prob_high_success &lt; 0.1</code>, consider the
treatment ineffective. - Otherwise, collect more data or refine the
model.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">7. Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>bnns</code> package empowers clinical trial analysts to
leverage Bayesian Neural Networks for predictive modeling and
decision-making. By utilizing posterior distributions, we can: -
Quantify uncertainty in predictions. - Make informed decisions about
treatment efficacy. - Evaluate trial outcomes based on predefined
success criteria.</p>
<p>This probabilistic framework is particularly valuable in scenarios
where uncertainty plays a critical role in decision-making, such as
early-phase clinical trials.</p>
<p>```</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Swarnendu Chatterjee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
